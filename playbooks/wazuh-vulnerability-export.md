---
tags:
  - wazuh
  - soc-playbook
  - vulnerability-management
  - siem
  - remediation
created: 2026-Feb-05
---

# Wazuh SOC Playbook: Before/After Vulnerability Export

## Overview

This playbook documents the process of exporting vulnerability data from Wazuh for a specific agent/machine to create before and after evidence for remediation documentation. This workflow is essential for SOC teams to prove security fixes and create repeatable playbooks.

> **Use Case:** Export vulnerability CSV data before remediation, perform fixes, then export after data to prove which CVEs were addressed.

## How It Works

Wazuh stores vulnerability data in the `wazuh-states-vulnerabilities-*` index. We create a saved search filtered by agent ID, then export it as CSV via the Reporting feature. The same search template can be reused for before/after comparisons.

### Key Components

| Component | Description |
|-----------|-------------|
| Index Pattern | `wazuh-states-vulnerabilities-*` |
| Filter | `agent.id: XXX` (e.g., `agent.id: 031`) |
| Export Format | CSV or XLSX |
| Location | Reporting > Reports |

## Step-by-Step Process

### Step 1: Navigate to Discover

1. Open Wazuh Dashboard
2. Click Menu > Explore > Discover

### Step 2: Select Vulnerability Index

1. Click the index pattern dropdown (default: `wazuh-alerts-*`)
2. Select `wazuh-states-vulnerabilities-*`

> **Finding Your Agent ID:** Agent IDs are 3-digit codes (e.g., 031). You can find them in Agents Management > Endpoints Summary, or from the URL when viewing an agent: `agent=031`

### Step 3: Filter by Agent

1. In the Search bar, type: `agent.id: 031` (replace 031 with your target agent ID)
2. Press Enter to apply the filter
3. Verify the hit count matches expected vulnerabilities

### Step 4: Save the Search (Template)

1. Click Save (top right)
2. Enter a descriptive name:
   - BEFORE: `SOC-Playbook-Vulnerabilities-Agent-031-BEFORE`
   - AFTER: `SOC-Playbook-Vulnerabilities-Agent-031-AFTER`
3. Click Save

> **Important:** You must save the search before the CSV export option becomes available.

### Step 5: Export CSV

1. Click Reporting (top right)
2. Click Generate CSV
3. Wait for generation (may take 1-2 minutes for large datasets)
4. Click View reports or navigate to Dashboard Management > Reporting
5. Find your report and click CSV to download

### Step 6: Capture Screenshots

For visual evidence, also capture:

1. **Vulnerability Detection Dashboard**
   - Navigate: Menu > Threat Intelligence > Vulnerability Detection
   - Pin your agent (click agent name > Pin)
   - Screenshot the severity counts (Critical, High, Medium, Low)

2. **Inventory View**
   - Click Inventory tab
   - Shows detailed CVE list with descriptions

## Data Fields in Export

The vulnerability CSV includes these key fields:

| Field | Description |
|-------|-------------|
| agent.id | Agent identifier |
| agent.name | Hostname (e.g., 80-IT000907) |
| package.name | Affected software |
| package.version | Software version |
| vulnerability.id | CVE identifier |
| vulnerability.severity | Critical/High/Medium/Low |
| vulnerability.description | What the vulnerability does |
| vulnerability.detected_at | When Wazuh detected it |
| vulnerability.published_at | When CVE was published |
| vulnerability.reference | Link to CVE details |
| vulnerability.classification | CVSS classification |

## Complete Before/After Workflow

```
BEFORE REMEDIATION
  1. Run saved search for target agent
  2. Export CSV -> save as "BEFORE_[date].csv"
  3. Screenshot dashboard (severity counts)
  4. Document counts: Critical, High, Medium, Low
        |
        v
REMEDIATION
  - Apply Windows Updates
  - Update Adobe Acrobat Reader DC
  - Update Microsoft Teams
  - Apply security patches
        |
        v
AFTER REMEDIATION
  1. Wait for Wazuh vulnerability scan (or trigger manually)
  2. Run same saved search
  3. Export CSV -> save as "AFTER_[date].csv"
  4. Screenshot dashboard (new severity counts)
  5. Compare CSVs to identify remediated CVEs
```

## Tips and Gotchas

**Reusable Template:** The saved search acts as a template. For different agents, duplicate the search and change only the `agent.id` filter.

**Session Timeout:** Wazuh sessions can timeout. If CSV download fails, log back in and navigate to Dashboard Management > Reporting to find your generated report.

**Large Exports:** For agents with 1000+ vulnerabilities, CSV generation may take several minutes. The report will appear in the Reports section when ready.

**Vulnerability Scan Timing:** After remediation, Wazuh needs to re-scan the agent. This typically happens:
- Automatically every 12 hours (default)
- Manually via restart (see commands below)

## Quick Reference Commands

### Trigger Vulnerability Scan on Agent (Linux)
```bash
sudo systemctl restart wazuh-agent
```

### Trigger Vulnerability Scan on Agent (Windows)
```powershell
Restart-Service WazuhSvc
```

### Wazuh API: Get Agent Vulnerabilities
```
GET /vulnerability/{agent_id}?limit=1000
```

## Example: Agent 80-IT000907

| Metric | Before | After |
|--------|--------|-------|
| Critical | 208 | - |
| High | 326 | - |
| Medium | 107 | - |
| Low | 16 | - |
| Total | 703 | - |

Top Affected Packages:
- Adobe Acrobat Reader DC: 580 CVEs
- Microsoft Windows 11 Enterprise: 116 CVEs
- Microsoft Teams: 7 CVEs

## Related Links

- [Wazuh Vulnerability Detection Docs](https://documentation.wazuh.com/current/user-manual/capabilities/vulnerability-detection/)
- [Wazuh API Reference](https://documentation.wazuh.com/current/user-manual/api/reference.html)
- [CVE Database](https://cve.mitre.org/)
