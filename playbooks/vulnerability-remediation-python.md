# Vulnerability Remediation Playbook: Python CVEs
**Type:** Software Patch Management / Python Environment Hygiene  
**Tooling:** Wazuh (detection) + Chocolatey/Package Manager (remediation)  
**Last Updated:** 2026-02-02

---

## Overview
Remediate Python-related CVEs detected by Wazuh vulnerability scanner. Addresses multiple Python installations and version sprawl.

**Example Case:** Multiple Python versions (3.10.11, 3.11.9) with critical CVE-2025-13836 on workstation, resolved by uninstalling outdated versions.

---

## Detection (Wazuh)

### Alert Signature
- **Rule Group:** `vulnerability-detector`
- **package.name:** `Python` or `Python 3.x`
- **severity:** Critical / High
- **cve:** CVE-2025-13836 (http.client DoS), CVE-2007-4559 (tarfile traversal), etc.

### Dashboard Query
```
vulnerability.severity: Critical
package.name: Python
```

### Sample Alert Fields
```json
{
  "data.vulnerability.package.name": "Python 3.10.11 (64-bit)",
  "data.vulnerability.package.version": "3.10.11",
  "data.vulnerability.cve": "CVE-2025-13836",
  "data.vulnerability.severity": "Critical"
}
```

---

## Investigation

### Step 1: Inventory Python Installations
```powershell
# Find ALL Python installations on system
Get-Command python* -ErrorAction SilentlyContinue | Format-Table -AutoSize

# Check specific paths
$paths = @(
    "C:\Python*",
    "C:\Program Files\Python*",
    "C:\ProgramData\chocolatey\bin\python*",
    "$env:LOCALAPPDATA\Programs\Python\*",
    "$env:LOCALAPPDATA\Microsoft\WindowsApps\python*"
)

foreach ($path in $paths) {
    Get-ChildItem $path -Filter "python.exe" -Recurse -ErrorAction SilentlyContinue | 
        Select-Object FullName, @{N="Version";E={[System.Diagnostics.FileVersionInfo]::GetVersionInfo($_.FullName).FileVersion}}
}
```

### Step 2: Identify Vulnerable Versions
Cross-reference installed versions with CVE database:
- **CVE-2025-13836** → Python < 3.10.16, < 3.11.11, < 3.12.3
- **CVE-2007-4559** → Python < 2.5 (legacy tarfile bug)

### Step 3: Check Active Usage
```powershell
# See if old Python versions are actually running
Get-Process | Where-Object {$_.Path -match "Python310|Python311|Python3\.10|Python3\.11"}

# Check PATH dependencies
$env:PATH -split ";" | Select-String "Python"
```

### Step 4: Determine Dependencies
```powershell
# List installed packages per Python version (if pip available)
& "C:\Users\srnea\AppData\Local\Programs\Python\Python310\python.exe" -m pip list
& "C:\Users\srnea\AppData\Local\Programs\Python\Python311\python.exe" -m pip list
```

---

## Remediation Options

### Option A: Uninstall Outdated Versions (Recommended if unused)

**Method 1: Official Uninstaller (Cleanest - Recommended)**

Python's official installer stores the setup EXE in Package Cache:

```powershell
# Find the uninstallers
Get-ChildItem "$env:LOCALAPPDATA\Package Cache\" -Filter "python*.exe" -Recurse

# Run official uninstallers with silent flags
# Python 3.10.11
& "$env:LOCALAPPDATA\Package Cache\{GUID}\python-3.10.11-amd64.exe" /uninstall /quiet

# Python 3.11.9  
& "$env:LOCALAPPDATA\Package Cache\{GUID}\python-3.11.9-amd64.exe" /uninstall /quiet
```

This runs the full MSI uninstall chain:
- Core interpreter
- Standard library
- pip
- tcl/tk
- Dev libraries
- Test suite

**Cleanup leftover artifacts:**
```powershell
# Uninstaller may leave empty folders if packages were installed
Remove-Item -Path "$env:LOCALAPPDATA\Programs\Python\Python310" -Recurse -Force -ErrorAction SilentlyContinue
Remove-Item -Path "$env:LOCALAPPDATA\Programs\Python\Python311" -Recurse -Force -ErrorAction SilentlyContinue

# Clean PATH if references remain
[Environment]::SetEnvironmentVariable("Path", ($env:Path -replace ";C:\\Users\\srnea\\AppData\\Local\\Programs\\Python\\Python310;", ""), "User")
[Environment]::SetEnvironmentVariable("Path", ($env:Path -replace ";C:\\Users\\srnea\\AppData\\Local\\Programs\\Python\\Python311;", ""), "User")
```

**Method 2: Via Chocolatey**
```powershell
# If originally installed via choco
choco uninstall python310 python311 -y
```

**Method 3: Windows Settings**
1. Settings → Apps → Installed apps
2. Search "Python"
3. Uninstall: "Python 3.10.11 (64-bit)" and "Python 3.11.9 (64-bit)"
4. Keep: Python 3.14.2 (patched)

### Option B: Update to Patched Versions

If you MUST keep 3.10/3.11 for compatibility:

```powershell
# Download and install patched versions
# Python 3.10.16+, 3.11.11+, 3.12.3+
choco upgrade python310 python311 -y
```

### Option C: Standardize on One Source

**Chocolatey approach (recommended for environments):**
```powershell
# Use Chocolatey as single source of truth
choco install python --version=3.14.2 -y
# Pin version: choco pin add -n python
```

**Windows Store approach (auto-updates):**
```powershell
winget install Python.Python.3.14
```

---

## Verification

### Immediate Check
```powershell
# Confirm old versions removed
Get-Command python* | Where-Object {$_.Version -lt "3.14.0"}

# Should return nothing (or only Windows Store shim)
```

### Wazuh Rescan
```powershell
# Restart Wazuh agent to trigger fresh scan
Restart-Service -Name "Wazuh"

# Or on agent directly:
& "C:\Program Files (x86)\ossec-agent\wazuh-agent.exe" restart
```

### Dashboard Confirmation
Wait 5-15 minutes for next vulnerability scan cycle:
```sql
-- Verify CVE cleared
SELECT * FROM alerts 
WHERE rule_group LIKE '%vulnerability%' 
  AND data->>'vulnerability.cve' = 'CVE-2025-13836'
  AND timestamp > NOW() - INTERVAL '1 hour';
```

Expected: **0 results** (or "resolved" status)

---

## Post-Remediation

### Standardization
- [ ] Document which Python version is "standard" for environment
- [ ] Add Python installation to build/deployment automation
- [ ] Include Python version check in onboarding scripts

### Prevention
- [ ] Schedule monthly `choco upgrade all` or equivalent
- [ ] Add Wazuh alert for NEW Python installations
- [ ] CI/CD pipeline check: reject builds with outdated Python

### Documentation
- [ ] Update asset inventory
- [ ] Record Python version standard in runbook
- [ ] Share remediation steps with team

---

## Lessons Learned (Python CVE Case)

| Issue | Root Cause | Prevention |
|-------|-----------|------------|
| Multiple Python versions | Manual installs over time | Standardize on one package manager |
| CVE accumulation | No update cadence | Monthly `choco upgrade` schedule |
| Alert noise | Version sprawl | Uninstall unused interpreters |
| Unclear ownership | "Might need it someday" mentality | Document which apps need which Python |

---

## Quick Reference: Python CVE-2025-13836

**Severity:** Critical  
**CVSS:** ~7.5 (High)  
**Attack Vector:** Network-based DoS  
**Affected:** Python http.client, versions < 3.10.16, < 3.11.11, < 3.12.3  
**Description:** Malicious HTTP server can cause excessive memory allocation via Content-Length header manipulation  
**Fix:** Upgrade Python or remove affected versions

---

## Playbook History

| Date | Action | Analyst | Notes |
|------|--------|---------|-------|
| 2026-02-02 | Initial draft | clawdbot | Based on Gandalf (001) remediation |
| 2026-02-02 | Tested remediation | solomon | Removed 3.10.11, 3.11.9; kept 3.14.2 |
| [PENDING] | Add automation script | solomon | Create GPO/Choco script for mass deployment |

---

## Related Playbooks
- [vulnerability-remediation-software.md](./vulnerability-remediation-software.md) - General software CVE process
- [vulnerability-remediation-adobe.md](./vulnerability-remediation-adobe.md) - Adobe-specific case

---

*Template for Python-related vulnerability remediation. Adapt version numbers as needed.*
